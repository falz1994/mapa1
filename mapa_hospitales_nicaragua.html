<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevos Hospitales en Construcci√≥n en Nicaragua</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        #map {
            height: 600px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 3px solid #fff;
        }
        
        .legend {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .legend h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 1.1em;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .hospital-construction {
            background: linear-gradient(45deg, #f39c12, #f1c40f);
        }
        
        .hospital-completed {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .no-hospital {
            background: linear-gradient(45deg, #95a5a6, #bdc3c7);
        }
        
        .popup-content {
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-width: 300px;
            max-width: 400px;
        }
        
        @media (max-width: 768px) {
            .popup-content {
                min-width: 280px;
                max-width: 320px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-content {
                min-width: 260px;
                max-width: 300px;
            }
        }
        
        .popup-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .popup-status {
            font-size: 1.1em;
            margin: 5px 0;
        }
        
        .status-construction {
            color: #f39c12;
        }
        
        .status-completed {
            color: #27ae60;
        }
        
        .status-none {
            color: #7f8c8d;
        }
        
        .emoji {
            font-size: 1.3em;
            margin-right: 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }
        
        .animation-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .animation-controls h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .animation-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .animation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .animation-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .animation-status {
            margin-top: 10px;
            font-size: 1em;
            color: #7f8c8d;
        }
        
        .tooltip-image {
            width: 100%;
            max-width: 350px;
            height: 250px;
            object-fit: cover;
            border-radius: 12px;
            margin: 15px auto;
            display: block;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            transition: opacity 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .tooltip-image {
                max-width: 280px;
                height: 200px;
                margin: 10px auto;
            }
        }
        
        @media (max-width: 480px) {
            .tooltip-image {
                max-width: 250px;
                height: 180px;
                margin: 8px auto;
            }
        }
        
        .image-container {
            position: relative;
            margin: 10px 0;
        }
        
        .image-counter {
            text-align: center;
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè• Nuevos Hospitales en Construcci√≥n en Nicaragua üè•</h1>
    </div>
    
    <div class="container">
        <div id="map"></div>
        
        <div class="legend">
            <h3>üìä Leyenda del Mapa</h3>
            <div class="legend-item">
                <div class="legend-color hospital-construction"></div>
                <span>üèóÔ∏è Hospitales en Construcci√≥n</span>
            </div>
            <div class="legend-item">
                <div class="legend-color hospital-completed"></div>
                <span>‚úÖ Hospitales Completados</span>
            </div>
            <div class="legend-item">
                <div class="legend-color no-hospital"></div>
                <span>üìç Sin Proyectos Hospitalarios</span>
            </div>
        </div>
        
        <div class="animation-controls">
            <h3>üé¨ Recorrido Autom√°tico</h3>
            <button id="startAnimation" class="animation-btn">‚ñ∂Ô∏è Iniciar Recorrido</button>
            <button id="stopAnimation" class="animation-btn" disabled>‚èπÔ∏è Detener</button>
            <div id="animationStatus" class="animation-status">Presiona "Iniciar Recorrido" para comenzar</div>
        </div>
    </div>
    
    <div class="footer">
        <p>üó∫Ô∏è Mapa de Nicaragua - Departamentos y Regiones Aut√≥nomas</p>
        <p>Datos actualizados sobre infraestructura hospitalaria</p>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <script>
        // Datos espec√≠ficos de hospitales proporcionados
        const hospitalData = {
            "Le√≥n": { 
                status: "completed", 
                name: "Hospital Escuela Oscar Danilo Rosales", 
                emoji: "üè•",
                fecha: "22 de septiembre de 2024",
                images: ["h1.jpg", "h2.jpg", "h3.jpg"]
            },
            "Matagalpa": { 
                status: "completed", 
                name: "Hospital Primario Fidel Ventura (Waslala)", 
                emoji: "üè•",
                fecha: "21 de abril de 2025",
                images: ["waslala1.jpg", "waslala2.jpg", "waslala3.jpg"]
            },
            "Atl√°nticoNorte": { 
                status: "construction", 
                name: "Hospital Regional Nuevo Amanecer (Bilwi)", 
                emoji: "üèóÔ∏è",
                fecha: "Dic. 2025 ‚Äì Ene. 2026",
                images: ["bilwi1.jpg", "bilwi2.jpg", "bilwi3.jpg"]
            },
            "NuevaSegovia": { 
                status: "completed", 
                name: "Hospital Departamental H√©roes de Las Segovias (Ocotal)", 
                emoji: "üè•",
                fecha: "2025",
                images: ["heroes1.jpg", "heroes2.jpg", "heroes3.jpg"]
            }
        };

        // Funci√≥n para obtener el color seg√∫n el estado
        function getColor(status) {
            switch(status) {
                case 'construction': return '#f39c12';  // Amarillo para construcci√≥n
                case 'completed': return '#27ae60';     // Verde para completados
                case 'none': return '#95a5a6';         // Gris para sin datos
                default: return '#95a5a6';
            }
        }

        // Funci√≥n para obtener el estilo del pol√≠gono
        function style(feature) {
            const departmentName = feature.properties.NAME_1;
            const hospitalInfo = hospitalData[departmentName];
            
            if (hospitalInfo) {
                return {
                    fillColor: getColor(hospitalInfo.status),
                    weight: 2,
                    opacity: 1,
                    color: '#fff',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            } else {
                return {
                    fillColor: '#95a5a6',
                    weight: 1,
                    opacity: 0.8,
                    color: '#7f8c8d',
                    dashArray: '1',
                    fillOpacity: 0.3
                };
            }
        }

        // Funci√≥n para crear el contenido del popup con im√°genes rotativas
        function createPopupContent(departmentName, hospitalInfo) {
            console.log(`=== CREANDO POPUP CONTENT PARA ${departmentName} ===`);
            console.log(`hospitalInfo.images:`, hospitalInfo.images);
            
            let statusText = '';
            let statusClass = '';
            
            switch(hospitalInfo.status) {
                case 'construction':
                    statusText = 'En Construcci√≥n';
                    statusClass = 'status-construction';
                    break;
                case 'completed':
                    statusText = 'Completado / Entregado';
                    statusClass = 'status-completed';
                    break;
            }
            
            let imageSection = '';
            if (hospitalInfo.images && hospitalInfo.images.length > 0) {
                console.log(`‚úÖ Creando secci√≥n de im√°genes para ${departmentName}`);
                const imageId = `images-${departmentName.replace(/\s+/g, '-')}`;
                console.log(`imageId generado: ${imageId}`);
                
                const imagesHtml = hospitalInfo.images.map((img, index) => 
                    `<img src="${img}" class="tooltip-image" style="display: ${index === 0 ? 'block' : 'none'};" id="${imageId}-${index}" alt="Imagen ${index + 1} del hospital">`
                ).join('');
                
                imageSection = `
                    <div class="image-container">
                        ${imagesHtml}
                        <div class="image-counter" id="${imageId}-counter">1 / ${hospitalInfo.images.length}</div>
                    </div>
                `;
                console.log(`HTML de im√°genes creado:`, imageSection);
            } else {
                console.log(`‚ùå No hay im√°genes para ${departmentName}`);
            }
            
            // Formatear nombre del departamento para mostrar
            let displayName = departmentName;
            if (departmentName === 'Atl√°nticoNorte') {
                displayName = 'Atl√°ntico Norte';
            } else if (departmentName === 'NuevaSegovia') {
                displayName = 'Nueva Segovia';
            }
            
            return `
                <div class="popup-content">
                    <div class="popup-title">${hospitalInfo.emoji} ${displayName}</div>
                    <div class="popup-status ${statusClass}">
                        <strong>${hospitalInfo.name}</strong>
                    </div>
                    <div class="popup-status ${statusClass}">
                        Estado: ${statusText}
                    </div>
                    <div class="popup-status ${statusClass}">
                        üìÖ Fecha: ${hospitalInfo.fecha}
                    </div>
                    ${imageSection}
                </div>
            `;
        }

        // Funci√≥n para iniciar la rotaci√≥n de im√°genes
        function startImageRotation(departmentName, images) {
            if (!images || images.length <= 1) return;
            
            const imageId = `images-${departmentName.replace(/\s+/g, '-')}`;
            let currentImageIndex = 0;
            let rotationCount = 0;
            const totalRotations = images.length; // N√∫mero de im√°genes = n√∫mero de rotaciones
            
            console.log(`Iniciando rotaci√≥n para ${departmentName}, im√°genes:`, images);
            
            // Funci√≥n para mostrar una imagen espec√≠fica
            function showImage(index) {
                console.log(`Mostrando imagen ${index}`);
                
                // Ocultar todas las im√°genes
                for (let i = 0; i < images.length; i++) {
                    const img = document.getElementById(`${imageId}-${i}`);
                    if (img) {
                        img.style.display = 'none';
                    }
                }
                
                // Mostrar imagen actual
                const currentImg = document.getElementById(`${imageId}-${index}`);
                if (currentImg) {
                    currentImg.style.display = 'block';
                    console.log(`Imagen ${index} mostrada`);
                }
                
                // Actualizar contador
                const counter = document.getElementById(`${imageId}-counter`);
                if (counter) {
                    counter.textContent = `${index + 1} / ${images.length}`;
                }
            }
            
            // Mostrar primera imagen
            showImage(0);
            
            // Usar setInterval para rotaci√≥n
            const rotationInterval = setInterval(() => {
                console.log(`Intervalo ejecut√°ndose - imagen actual: ${currentImageIndex}`);
                currentImageIndex = (currentImageIndex + 1) % images.length;
                rotationCount++;
                console.log(`Cambiando a imagen ${currentImageIndex}, rotaci√≥n ${rotationCount}/${totalRotations}`);
                showImage(currentImageIndex);
                
                // Si hemos completado todas las rotaciones, marcar como completado
                if (rotationCount >= totalRotations) {
                    console.log(`Rotaci√≥n completada para ${departmentName}`);
                    clearInterval(rotationInterval);
                    delete window[`interval-${imageId}`];
                    
                    // Marcar que este departamento ha terminado su rotaci√≥n
                    window[`rotation-completed-${imageId}`] = true;
                }
            }, 6000);
            
            // Guardar el intervalo
            window[`interval-${imageId}`] = rotationInterval;
            
            console.log(`Rotaci√≥n iniciada para ${imageId} con intervalo ${rotationInterval}`);
        }

        // Funci√≥n para detener la rotaci√≥n de im√°genes
        function stopImageRotation(departmentName) {
            const imageId = `images-${departmentName.replace(/\s+/g, '-')}`;
            const interval = window[`interval-${imageId}`];
            if (interval) {
                clearInterval(interval);
                delete window[`interval-${imageId}`];
                console.log(`Rotaci√≥n detenida para ${imageId}`);
            }
        }


        // Funci√≥n para mostrar informaci√≥n en el popup
        function onEachFeature(feature, layer) {
            const departmentName = feature.properties.NAME_1;
            const hospitalInfo = hospitalData[departmentName];
            
            console.log(`=== PROCESANDO DEPARTAMENTO: ${departmentName} ===`);
            console.log(`hospitalInfo encontrado:`, hospitalInfo);
            
            if (hospitalInfo) {
                console.log(`‚úÖ Creando popup para ${departmentName}`);
                const popupContent = createPopupContent(departmentName, hospitalInfo);
                
                layer.bindPopup(popupContent, {
                    onOpen: function() {
                        console.log(`=== POPUP ABIERTO PARA ${departmentName} ===`);
                        console.log(`hospitalInfo:`, hospitalInfo);
                        console.log(`hospitalInfo.images:`, hospitalInfo.images);
                        console.log(`hospitalInfo.images.length:`, hospitalInfo.images ? hospitalInfo.images.length : 'undefined');
                        
                        // Iniciar rotaci√≥n de im√°genes cuando se abre el popup
                        if (hospitalInfo.images && hospitalInfo.images.length > 0) {
                            console.log(`‚úÖ Condici√≥n cumplida - iniciando rotaci√≥n`);
                            
                            // Iniciar rotaci√≥n despu√©s de un breve delay
                            setTimeout(() => {
                                console.log(`‚è∞ Timeout ejecutado - llamando startImageRotation`);
                                startImageRotation(departmentName, hospitalInfo.images);
                            }, 100);
                        } else {
                            console.log(`‚ùå Condici√≥n NO cumplida - no hay im√°genes`);
                        }
                    },
                    onClose: function() {
                        // Detener rotaci√≥n de im√°genes cuando se cierra el popup
                        console.log(`=== POPUP CERRADO PARA ${departmentName} ===`);
                        stopImageRotation(departmentName);
                    }
                });
            } else {
                const popupContent = `
                    <div class="popup-content">
                        <div class="popup-title">üìç ${departmentName}</div>
                        <div class="popup-status status-none">
                            Sin proyectos hospitalarios
                        </div>
                    </div>
                `;
                
                layer.bindPopup(popupContent);
            }
        }

        // Inicializar el mapa
        const map = L.map('map').setView([12.8667, -85.2072], 7);

        // Agregar capa de tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Variables para la animaci√≥n
        let geoJsonLayer;
        let animationInterval;
        let currentIndex = 0;
        let isAnimating = false;
        let departmentsWithHospitals = [];
        let completedHospitals = [];
        let constructionHospitals = [];

        // Cargar y mostrar el GeoJSON
        fetch('gadm41_NIC_2.json')
            .then(response => response.json())
            .then(data => {
                geoJsonLayer = L.geoJSON(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // Separar departamentos por estado de hospital
                data.features.forEach(feature => {
                    const departmentName = feature.properties.NAME_1;
                    const hospitalInfo = hospitalData[departmentName];
                    
                    if (hospitalInfo) {
                        if (hospitalInfo.status === 'completed') {
                            completedHospitals.push(feature);
                        } else if (hospitalInfo.status === 'construction') {
                            constructionHospitals.push(feature);
                        }
                    }
                });
                
                // Combinar: primero completados, luego en construcci√≥n
                departmentsWithHospitals = [...completedHospitals, ...constructionHospitals];
                
                // Configurar controles de animaci√≥n
                setupAnimationControls();
            })
            .catch(error => {
                console.error('Error cargando el GeoJSON:', error);
                // Mostrar mensaje de error en el mapa
                L.marker([12.8667, -85.2072]).addTo(map)
                    .bindPopup('Error cargando los datos del mapa')
                    .openPopup();
            });

        // Funci√≥n para configurar los controles de animaci√≥n
        function setupAnimationControls() {
            const startBtn = document.getElementById('startAnimation');
            const stopBtn = document.getElementById('stopAnimation');
            const statusDiv = document.getElementById('animationStatus');
            
            startBtn.addEventListener('click', startAnimation);
            stopBtn.addEventListener('click', stopAnimation);
        }

        // Funci√≥n para iniciar la animaci√≥n
        function startAnimation() {
            if (isAnimating) return;
            
            isAnimating = true;
            currentIndex = 0;
            
            const startBtn = document.getElementById('startAnimation');
            const stopBtn = document.getElementById('stopAnimation');
            const statusDiv = document.getElementById('animationStatus');
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // Mostrar todo Nicaragua primero
            statusDiv.textContent = 'Mostrando Nicaragua completa...';
            map.setView([12.8667, -85.2072], 7, {
                animate: true,
                duration: 1.0
            });
            
            // Despu√©s de 3 segundos, comenzar con los hospitales
            setTimeout(() => {
                showNextDepartment();
            }, 3000);
        }
        
        // Funci√≥n para verificar si la rotaci√≥n ha terminado y avanzar
        function checkAndAdvance() {
            if (!isAnimating) return;
            
            if (currentIndex >= departmentsWithHospitals.length) {
                // Terminar animaci√≥n
                stopAnimation();
                return;
            }
            
            const currentDepartment = departmentsWithHospitals[currentIndex];
            const departmentName = currentDepartment.properties.NAME_1;
            const imageId = `images-${departmentName.replace(/\s+/g, '-')}`;
            
            // Verificar si la rotaci√≥n ha terminado
            if (window[`rotation-completed-${imageId}`]) {
                console.log(`Rotaci√≥n completada para ${departmentName}, avanzando al siguiente`);
                currentIndex++;
                
                if (currentIndex < departmentsWithHospitals.length) {
                    showNextDepartment();
                } else {
                    stopAnimation();
                }
            } else {
                // Verificar de nuevo en 1 segundo
                setTimeout(checkAndAdvance, 1000);
            }
        }

        // Funci√≥n para detener la animaci√≥n
        function stopAnimation() {
            if (!isAnimating) return;
            
            isAnimating = false;
            
            const startBtn = document.getElementById('startAnimation');
            const stopBtn = document.getElementById('stopAnimation');
            const statusDiv = document.getElementById('animationStatus');
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            // Detener rotaci√≥n de im√°genes de todos los departamentos
            Object.keys(hospitalData).forEach(departmentName => {
                stopImageRotation(departmentName);
                // Limpiar marcas de rotaci√≥n completada
                const imageId = `images-${departmentName.replace(/\s+/g, '-')}`;
                delete window[`rotation-completed-${imageId}`];
            });
            
            // Cerrar cualquier popup abierto
            map.closePopup();
            statusDiv.textContent = 'Recorrido detenido';
        }

        // Funci√≥n para calcular el centro geom√©trico de un pol√≠gono
        function calculateCenter(geometry) {
            if (geometry.type === 'Polygon') {
                const coordinates = geometry.coordinates[0];
                let sumLat = 0, sumLng = 0;
                coordinates.forEach(coord => {
                    sumLng += coord[0];
                    sumLat += coord[1];
                });
                return [sumLat / coordinates.length, sumLng / coordinates.length];
            } else if (geometry.type === 'MultiPolygon') {
                // Para MultiPolygon, calcular el centro del pol√≠gono m√°s grande
                let maxArea = 0;
                let centerPolygon = null;
                
                geometry.coordinates.forEach(polygon => {
                    const area = calculatePolygonArea(polygon[0]);
                    if (area > maxArea) {
                        maxArea = area;
                        centerPolygon = polygon[0];
                    }
                });
                
                let sumLat = 0, sumLng = 0;
                centerPolygon.forEach(coord => {
                    sumLng += coord[0];
                    sumLat += coord[1];
                });
                return [sumLat / centerPolygon.length, sumLng / centerPolygon.length];
            }
            return [12.8667, -85.2072]; // Centro de Nicaragua como fallback
        }

        // Funci√≥n para calcular el √°rea de un pol√≠gono
        function calculatePolygonArea(coordinates) {
            let area = 0;
            for (let i = 0; i < coordinates.length - 1; i++) {
                area += coordinates[i][0] * coordinates[i + 1][1];
                area -= coordinates[i + 1][0] * coordinates[i][1];
            }
            return Math.abs(area) / 2;
        }

        // Funci√≥n para mostrar el siguiente departamento
        function showNextDepartment() {
            if (currentIndex >= departmentsWithHospitals.length) return;
            
            const department = departmentsWithHospitals[currentIndex];
            const departmentName = department.properties.NAME_1;
            const statusDiv = document.getElementById('animationStatus');
            
            // Detener rotaci√≥n de im√°genes del departamento anterior
            if (currentIndex > 0) {
                const prevDepartment = departmentsWithHospitals[currentIndex - 1];
                const prevDepartmentName = prevDepartment.properties.NAME_1;
                stopImageRotation(prevDepartmentName);
            }
            
            // Formatear nombre del departamento para mostrar
            let displayName = departmentName;
            if (departmentName === 'Atl√°nticoNorte') {
                displayName = 'Atl√°ntico Norte';
            } else if (departmentName === 'NuevaSegovia') {
                displayName = 'Nueva Segovia';
            }
            
            // Determinar si es completado o en construcci√≥n
            const hospitalInfo = hospitalData[departmentName];
            const statusText = hospitalInfo.status === 'completed' ? 'Completado' : 'En Construcci√≥n';
            
            // Actualizar estado
            statusDiv.textContent = `Mostrando: ${displayName} (${statusText}) - ${currentIndex + 1}/${departmentsWithHospitals.length}`;
            
            // Calcular el centro geom√©trico del departamento
            const center = calculateCenter(department.geometry);
            
            // Mover la c√°mara al centro del departamento con zoom apropiado
            map.setView([center[0], center[1]], 8, {
                animate: true,
                duration: 1.0
            });
            
            // Abrir popup despu√©s de un peque√±o delay para que termine el movimiento
            setTimeout(() => {
                // Buscar el layer correspondiente y abrir su popup
                geoJsonLayer.eachLayer(function(layer) {
                    if (layer.feature.properties.NAME_1 === departmentName) {
                        layer.openPopup();
                        
                        // Iniciar rotaci√≥n de im√°genes si el departamento tiene hospitales
                        const hospitalInfo = hospitalData[departmentName];
                        if (hospitalInfo && hospitalInfo.images && hospitalInfo.images.length > 0) {
                            console.log(`Iniciando rotaci√≥n autom√°tica para ${departmentName}`);
                            setTimeout(() => {
                                startImageRotation(departmentName, hospitalInfo.images);
                                // Iniciar verificaci√≥n para avanzar al siguiente departamento
                                setTimeout(checkAndAdvance, 1000);
                            }, 500);
                        } else {
                            // Si no hay im√°genes, avanzar despu√©s de 6 segundos
                            setTimeout(() => {
                                currentIndex++;
                                if (currentIndex < departmentsWithHospitals.length) {
                                    showNextDepartment();
                                } else {
                                    stopAnimation();
                                }
                            }, 6000);
                        }
                    }
                });
            }, 1000);
        }
    </script>
</body>
</html>
